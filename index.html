<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Resistance</title>
  <style type="text/css" media="screen">
body {
  background-color: white;
  color: black;
}
fieldset {
  margin: 0.5em;
}
fieldset ul.options {
  list-style: none inside none;
  margin: 0.5em;
  padding: 0;
}
.hidden {
  display: none;
}
.pink {
  background-color: #ff69b4;
}
.silver {
  background-color: #c0c0c0;
}
.gold {
  background-color: #cfb53b;
}
.black {
  background-color: black;
  color: white;
}
.brown {
  background-color: #964b00;
  color: white;
}
.red {
  background-color: red;
  color: white;
}
.orange {
  background-color: #ffa500;
}
.yellow {
  background-color: yellow;
}
.green {
  background-color: #9acd32;
}
.blue {
  background-color: #6495ed;
}
.violet {
  background-color: #9400d3;
  color: white;
}
.grey {
  background-color: #a0a0a0;
}
@media screen and (min-width: 640px) {
  section {
    display: flex;
    flex-flow: row nowrap;
  }
}
  </style>
</head>

<body>

<main>
<h1>The Resistance</h1>

<p>If the resistor looks like</p>

<canvas id="resistor"></canvas>

<p>Then the resistance is <output id="resistance" for="banding"></output></p>

<form id="banding" name="banding">

<div>
<label for="bandCount">Number of bands:</label> <input type="number" id="bandCount" name="bandCount" value="4" min="3" max="5">
</div>

<section>

<fieldset id="band1Options">
  <legend>Band 1</legend>
  <ul class="options">
    <li>
      <label><input type="radio" name="band1" value="none"> None</label>
    </li>
    <li class="pink">
      <label><input type="radio" name="band1" value="pink"> Pink</label>
    </li>
    <li class="silver">
      <label><input type="radio" name="band1" value="silver"> Silver</label>
    </li>
    <li class="gold">
      <label><input type="radio" name="band1" value="gold"> Gold</label>
    </li>
    <li class="black">
      <label><input type="radio" name="band1" value="black" checked> Black (0)</label>
    </li>
    <li class="brown">
      <label><input type="radio" name="band1" value="brown"> Brown (1)</label>
    </li>
    <li class="red">
      <label><input type="radio" name="band1" value="red"> Red (2)</label>
    </li>
    <li class="orange">
      <label><input type="radio" name="band1" value="orange"> Orange (3)</label>
    </li>
    <li class="yellow">
      <label><input type="radio" name="band1" value="yellow"> Yellow (4)</label>
    </li>
    <li class="green">
      <label><input type="radio" name="band1" value="green"> Green (5)</label>
    </li>
    <li class="blue">
      <label><input type="radio" name="band1" value="blue"> Blue (6)</label>
    </li>
    <li class="violet">
      <label><input type="radio" name="band1" value="violet"> Violet (7)</label>
    </li>
    <li class="grey">
      <label><input type="radio" name="band1" value="grey"> Grey (8)</label>
    </li>
    <li class="white">
      <label><input type="radio" name="band1" value="white"> White (9)</label>
    </li>
  </ul>
</fieldset>

<fieldset id="band2Options">
  <legend>Band 2</legend>
  <ul class="options">
    <li>
      <label><input type="radio" name="band2" value="none"> None</label>
    </li>
    <li class="pink">
      <label><input type="radio" name="band2" value="pink"> Pink</label>
    </li>
    <li class="silver">
      <label><input type="radio" name="band2" value="silver"> Silver</label>
    </li>
    <li class="gold">
      <label><input type="radio" name="band2" value="gold"> Gold</label>
    </li>
    <li class="black">
      <label><input type="radio" name="band2" value="black" checked> Black (0)</label>
    </li>
    <li class="brown">
      <label><input type="radio" name="band2" value="brown"> Brown (1)</label>
    </li>
    <li class="red">
      <label><input type="radio" name="band2" value="red"> Red (2)</label>
    </li>
    <li class="orange">
      <label><input type="radio" name="band2" value="orange"> Orange (3)</label>
    </li>
    <li class="yellow">
      <label><input type="radio" name="band2" value="yellow"> Yellow (4)</label>
    </li>
    <li class="green">
      <label><input type="radio" name="band2" value="green"> Green (5)</label>
    </li>
    <li class="blue">
      <label><input type="radio" name="band2" value="blue"> Blue (6)</label>
    </li>
    <li class="violet">
      <label><input type="radio" name="band2" value="violet"> Violet (7)</label>
    </li>
    <li class="grey">
      <label><input type="radio" name="band2" value="grey"> Grey (8)</label>
    </li>
    <li class="white">
      <label><input type="radio" name="band2" value="white"> White (9)</label>
    </li>
  </ul>
</fieldset>

<fieldset id="band3Options" class="hidden">
  <legend>Band 3</legend>
  <ul class="options">
    <li>
      <label><input type="radio" name="band3" value="none" checked> None</label>
    </li>
    <li class="pink">
      <label><input type="radio" name="band3" value="pink"> Pink</label>
    </li>
    <li class="silver">
      <label><input type="radio" name="band3" value="silver"> Silver</label>
    </li>
    <li class="gold">
      <label><input type="radio" name="band3" value="gold"> Gold</label>
    </li>
    <li class="black">
      <label><input type="radio" name="band3" value="black"> Black (0)</label>
    </li>
    <li class="brown">
      <label><input type="radio" name="band3" value="brown"> Brown (1)</label>
    </li>
    <li class="red">
      <label><input type="radio" name="band3" value="red"> Red (2)</label>
    </li>
    <li class="orange">
      <label><input type="radio" name="band3" value="orange"> Orange (3)</label>
    </li>
    <li class="yellow">
      <label><input type="radio" name="band3" value="yellow"> Yellow (4)</label>
    </li>
    <li class="green">
      <label><input type="radio" name="band3" value="green"> Green (5)</label>
    </li>
    <li class="blue">
      <label><input type="radio" name="band3" value="blue"> Blue (6)</label>
    </li>
    <li class="violet">
      <label><input type="radio" name="band3" value="violet"> Violet (7)</label>
    </li>
    <li class="grey">
      <label><input type="radio" name="band3" value="grey"> Grey (8)</label>
    </li>
    <li class="white">
      <label><input type="radio" name="band3" value="white"> White (9)</label>
    </li>
  </ul>
</fieldset>

<fieldset id="multiplierOptions">
  <legend>Multiplier</legend>
  <ul class="options">
    <li>
      <label><input type="radio" name="multiplier" value="none"> None</label>
    </li>
    <li class="pink">
      <label><input type="radio" name="multiplier" value="pink"> Pink (&times;0.001)</label>
    </li>
    <li class="silver">
      <label><input type="radio" name="multiplier" value="silver"> Silver (&times;0.01)</label>
    </li>
    <li class="gold">
      <label><input type="radio" name="multiplier" value="gold"> Gold (&times;0.1)</label>
    </li>
    <li class="black">
      <label><input type="radio" name="multiplier" value="black" checked> Black (&times;1)</label>
    </li>
    <li class="brown">
      <label><input type="radio" name="multiplier" value="brown"> Brown (&times;10)</label>
    </li>
    <li class="red">
      <label><input type="radio" name="multiplier" value="red"> Red (&times;100)</label>
    </li>
    <li class="orange">
      <label><input type="radio" name="multiplier" value="orange"> Orange (&times;1000)</label>
    </li>
    <li class="yellow">
      <label><input type="radio" name="multiplier" value="yellow"> Yellow (&times;10000)</label>
    </li>
    <li class="green">
      <label><input type="radio" name="multiplier" value="green"> Green (&times;100000)</label>
    </li>
    <li class="blue">
      <label><input type="radio" name="multiplier" value="blue"> Blue (&times;1000000)</label>
    </li>
    <li class="violet">
      <label><input type="radio" name="multiplier" value="violet"> Violet (&times;10000000)</label>
    </li>
    <li class="grey">
      <label><input type="radio" name="multiplier" value="grey"> Grey (&times;100000000)</label>
    </li>
    <li class="white">
      <label><input type="radio" name="multiplier" value="white"> White (&times;1000000000)</label>
    </li>
  </ul>
</fieldset>

<fieldset id="toleranceOptions">
  <legend>Tolerance</legend>
  <ul class="options">
    <li>
      <label><input type="radio" name="tolerance" value="none" checked> None (&pm;20%)</label>
    </li>
    <li class="pink">
      <label><input type="radio" name="tolerance" value="pink"> Pink</label>
    </li>
    <li class="silver">
      <label><input type="radio" name="tolerance" value="silver"> Silver (&pm;10%)</label>
    </li>
    <li class="gold">
      <label><input type="radio" name="tolerance" value="gold"> Gold (&pm;5%)</label>
    </li>
    <li class="black">
      <label><input type="radio" name="tolerance" value="black"> Black</label>
    </li>
    <li class="brown">
      <label><input type="radio" name="tolerance" value="brown"> Brown (&pm;1%)</label>
    </li>
    <li class="red">
      <label><input type="radio" name="tolerance" value="red"> Red (&pm;2%)</label>
    </li>
    <li class="orange">
      <label><input type="radio" name="tolerance" value="orange"> Orange (&pm;0.05%)</label>
    </li>
    <li class="yellow">
      <label><input type="radio" name="tolerance" value="yellow"> Yellow (&pm;0.02%)</label>
    </li>
    <li class="green">
      <label><input type="radio" name="tolerance" value="green"> Green (&pm;0.5%)</label>
    </li>
    <li class="blue">
      <label><input type="radio" name="tolerance" value="blue"> Blue (&pm;0.25%)</label>
    </li>
    <li class="violet">
      <label><input type="radio" name="tolerance" value="violet"> Violet (&pm;0.1%)</label>
    </li>
    <li class="grey">
      <label><input type="radio" name="tolerance" value="grey"> Grey (&pm;0.01%)</label>
    </li>
    <li class="white">
      <label><input type="radio" name="tolerance" value="white"> White</label>
    </li>
  </ul>
</fieldset>

</section>

</form>

<h2>References</h2>

<ul>
  <li><a href="https://en.wikipedia.org/wiki/Electronic_color_code" target="_blank">Electronic color code on Wikipedia</a></li>
</ul>

</main>

<script>
/*
 * Map a color band to its properties
 */
const BAND_MAP = new Map([
  ['none', {
    color: "",
    value: 0,
    multiplier: 0,
    tolerance: "\u00B120%"}],
  ['pink', {
    color: "#ff69b4",
    value: 0,
    multiplier: 0.001,
    tolerance: ""}],
  ['silver', {
    color: "#c0c0c0",
    value: 0,
    multiplier: 0.01,
    tolerance: "\u00B110%"}],
  ['gold', {
    color: "#cfb53b",
    value: 0,
    multiplier: 0.1,
    tolerance: "\u00B15%"}],
  ['black', {
    color: "#000000",
    value: 0,
    multiplier: 1,
    tolerance: ""}],
  ['brown', {
    color: "#964b00",
    value: 1,
    multiplier: 10,
    tolerance: "\u00B11%"}],
  ['red', {
    color: "#ff0000",
    value: 2,
    multiplier: 100,
    tolerance: "\u00B12%"}],
  ['orange', {
    color: "#ffa500",
    value: 3,
    multiplier: 1000,
    tolerance: "\u00B10.05%"}],
  ['yellow', {
    color: "#ffff00",
    value: 4,
    multiplier: 10000,
    tolerance: "\u00B10.02%"}],
  ['green', {
    color: "#9acd32",
    value: 5,
    multiplier: 100000,
    tolerance: "\u00B10.5%"}],
  ['blue', {
    color: "#6495ed",
    value: 6,
    multiplier: 1000000,
    tolerance: "\u00B10.25%"}],
  ['violet', {
    color: "#9400d3",
    value: 7,
    multiplier: 10000000,
    tolerance: "\u00B10.1%"}],
  ['grey', {
    color: "#a0a0a0",
    value: 8,
    multiplier: 100000000,
    tolerance: "\u00B10.01%"}],
  ['white', {
    color: "#ffffff",
    value: 9,
    multiplier: 1000000000,
    tolerance: ""}]]);

class Resistor {
  constructor(band1 = 'none', band2 = 'none', band3 = 'none', multiplier = 'none', tolerance = 'none') {
    this.band1 = Resistor.getValidValue(band1.trim().toLowerCase());
    this.band2 = Resistor.getValidValue(band2.trim().toLowerCase());
    this.band3 = Resistor.getValidValue(band3.trim().toLowerCase());
    this.multiplier = Resistor.getValidValue(multiplier.trim().toLowerCase());
    this.tolerance = Resistor.getValidValue(tolerance.trim().toLowerCase());
  }
  get band1Color() {
    return BAND_MAP.get(this.band1).color;
  }
  get band2Color() {
    return BAND_MAP.get(this.band2).color;
  }
  get band3Color() {
    return BAND_MAP.get(this.band3).color;
  }
  get multiplierColor() {
    return BAND_MAP.get(this.multiplier).color;
  }
  get toleranceColor() {
    return BAND_MAP.get(this.tolerance).color;
  }
  get resistance() {
    let values = [];
    if (this.band1 != 'none') {
      values.push('' + BAND_MAP.get(this.band1).value);
    }
    if (this.band2 != 'none') {
      values.push('' + BAND_MAP.get(this.band2).value);
    }
    if (this.band3 != 'none') {
      values.push('' + BAND_MAP.get(this.band3).value);
    }
    let value = Number(values.join('')) * BAND_MAP.get(this.multiplier).multiplier;
    return (value + BAND_MAP.get(this.tolerance).tolerance + ' ohms');
  }

  static getValidValue(value, fallback = 'none') {
    if (BAND_MAP.has(value)) {
      return value;
    }
    else {
      return fallback;
    }
  }

  static test() {
    for (let [value, expected] of [
      ['foo', 'none'],
      ['BAR', 'none'],
      ['Baz', 'none'],
      ['none', 'none']]) {
      console.assert(Resistor.getValidValue(value) == expected,
                     {msg: 'Resistor.getValidValue() is incorrect.'});
    }
    for (let value of BAND_MAP.keys()) {
      console.assert(Resistor.getValidValue(value) == value,
                     {msg: 'Resistor.getValidValue() is incorrect.'});
      console.assert(Resistor.getValidValue(value.toUpperCase(), 'foobar') == 'foobar',
                     {msg: 'Resistor.getValidValue() is incorrect.'});
    }

    function testResistor(resistor, band1Color, band2Color, band3Color, multiplierColor, toleranceColor, resistance) {
      console.assert(resistor.band1Color == band1Color,
                     {msg: 'band1Color is incorrect.'});
      console.assert(resistor.band2Color == band2Color,
                     {msg: 'band2Color is incorrect.'});
      console.assert(resistor.band3Color == band3Color,
                     {msg: 'band3Color is incorrect.'});
      console.assert(resistor.multiplierColor == multiplierColor,
                     {msg: 'multiplierColor is incorrect.'});
      console.assert(resistor.toleranceColor == toleranceColor,
                     {msg: 'toleranceColor is incorrect.'});
      console.assert(resistor.resistance == resistance,
                     {msg: 'resistance is incorrect.'});
    }

    let resistor = new Resistor();
    testResistor(resistor, '', '', '', '', '', '0\u00B120% ohms');

    resistor = new Resistor('none', 'NONE', 'None', 'nonE', 'nONe');
    testResistor(resistor, '', '', '', '', '', '0\u00B120% ohms');

    resistor = new Resistor('RED', 'red', 'blue', 'brown', 'brown');
    testResistor(resistor, BAND_MAP.get('red').color, BAND_MAP.get('red').color, BAND_MAP.get('blue').color, BAND_MAP.get('brown').color, BAND_MAP.get('brown').color, '2260\u00B11% ohms');

    resistor = new Resistor('green', 'Blue', 'black', 'black', 'brown');
    testResistor(resistor, BAND_MAP.get('green').color, BAND_MAP.get('blue').color, BAND_MAP.get('black').color, BAND_MAP.get('black').color, BAND_MAP.get('brown').color, '560\u00B11% ohms');

    resistor = new Resistor('red', 'red', 'NONE', 'orange', 'gold');
    testResistor(resistor, BAND_MAP.get('red').color, BAND_MAP.get('red').color, '', BAND_MAP.get('orange').color, BAND_MAP.get('gold').color, '22000\u00B15% ohms');

    resistor = new Resistor('yellow', 'violet', 'none', 'Brown', 'gold');
    testResistor(resistor, BAND_MAP.get('yellow').color, BAND_MAP.get('violet').color, '', BAND_MAP.get('brown').color, BAND_MAP.get('gold').color, '470\u00B15% ohms');

    resistor = new Resistor('blue', 'grey', 'none', 'black', 'GOLD');
    testResistor(resistor, BAND_MAP.get('blue').color, BAND_MAP.get('grey').color, '', BAND_MAP.get('black').color, BAND_MAP.get('gold').color, '68\u00B15% ohms');

    resistor = new Resistor(' red', 'violet ', 'none', ' green ', '  brown  ');
    testResistor(resistor, BAND_MAP.get('red').color, BAND_MAP.get('violet').color, '', BAND_MAP.get('green').color, BAND_MAP.get('brown').color, '2700000\u00B11% ohms');

    resistor = new Resistor('red', 'red', 'black', 'red', 'gold');
    testResistor(resistor, BAND_MAP.get('red').color, BAND_MAP.get('red').color, BAND_MAP.get('black').color, BAND_MAP.get('red').color, BAND_MAP.get('gold').color, '22000\u00B15% ohms');
  }
}
Resistor.test();

class ResistorDisplay {
  constructor(canvas, output, bandWidth = 20) {
    if (!(canvas instanceof Node)) {
      throw new TypeError('Bad canvas.');
    }
    if (!(output instanceof Node)) {
      throw new TypeError('Bad output.');
    }
    this.canvas = canvas;
    this.output = output;
    this.bandWidth = bandWidth;
    this.halfWidth = Math.floor(this.bandWidth / 2);
  }
  draw(resistor) {
    // Write out the resistance value
    this.output.textContent = resistor.resistance;

    let context = this.canvas.getContext('2d'),
        width = this.canvas.width,
        height = this.canvas.height,
        offsetX = Math.floor(width / 8),
        centerY = Math.floor(height / 2),
        x = 0;

    // Draw the wire
    context.fillStyle = '#a0a0a0';
    context.fillRect(x, centerY - this.halfWidth, width, this.bandWidth);
    x += offsetX;

    // Draw the resistor body
    context.fillStyle = '#f5f5dc';
    context.fillRect(x, 0, width - (offsetX * 2), height);
    x += offsetX;

    // Draw the bands
    let colors = [
      resistor.band1Color,
      resistor.band2Color,
      resistor.band3Color,
      resistor.multiplierColor,
      resistor.toleranceColor
    ];
    for (let color of colors) {
      if (color.startsWith('#')) {
        context.fillStyle = color;
        context.fillRect(x - this.halfWidth, 0, this.bandWidth, height);
      }
      x += offsetX;
    }
  }
}

let resistor = null;
const display = new ResistorDisplay(document.querySelector('#resistor'), document.querySelector('#resistance'));
const form = document.querySelector('#banding');
function drawResistor() {
  resistor = new Resistor(form.band1.value, form.band2.value, form.band3.value, form.multiplier.value, form.tolerance.value);
  display.draw(resistor);
}

form.querySelector('#bandCount').addEventListener('change', (event) => {
  let count = form.bandCount.value,
      band3 = form.querySelector('#band3Options'),
      tolerance = form.querySelector('#toleranceOptions');
  if (count == 3) {
    band3.setAttribute('class', 'hidden');
    tolerance.setAttribute('class', 'hidden');
    form.band3.value = 'none';
    form.tolerance.value = 'none';
  }
  else if (count == 4) {
    band3.setAttribute('class', 'hidden');
    tolerance.setAttribute('class', '');
    form.band3.value = 'none';
  }
  else {
    band3.setAttribute('class', '');
    tolerance.setAttribute('class', '');
  }
  drawResistor();
});
for (let radio of Array.from(form.querySelectorAll('input[type="radio"]'))) {
  radio.addEventListener('change', (event) => {
    drawResistor();
  });
}

drawResistor();
</script>
</body>

</html>
